<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì–‘ìì»´í“¨í„°ê°€ ë°”ê¿€ ë¯¸ë˜ì˜ ê³„ì‚° | LabWave</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body class="topic-page">
  <!-- ë°°ê²½(ë³„/ê·¸ë¼ë””ì–¸íŠ¸) -->
  <div class="bg" aria-hidden="true">
    <div class="stars"></div>
    <div class="stars stars2"></div>
    <div class="glow"></div>
  </div>

  <!-- ìƒë‹¨ë°”(ê°„ë‹¨) -->
  <header class="navbar">
    <div class="container nav-inner">
      <a class="brand" href="index.html">
        <div class="brand-mark">L</div>
        <div class="brand-name">LabWave</div>
      </a>

      <div class="nav-actions">
        <a class="btn btn-ghost btn-sm" href="profile.html">í”„ë¡œí•„/ë¡œê·¸ì¸</a>
        <a class="btn btn-ghost btn-sm" href="index.html#content">â† ëŒì•„ê°€ê¸°</a>
      </div>
    </div>
  </header>

  <main class="section">
    <div class="container">
      <!-- ì¹¼ëŸ¼ í—¤ë” -->
      <div class="article-head">
        <span class="section-pill">Hot Topic</span>
        <h1 class="article-title">ì–‘ìì»´í“¨í„°ê°€ ë°”ê¿€ ë¯¸ë˜ì˜ ê³„ì‚°</h1>
        <p class="article-sub">
          ê¸°ì¡´ ì»´í“¨í„°ì˜ í•œê³„ë¥¼ ë„˜ëŠ” ê³„ì‚° ë°©ì‹ì´ ë“±ì¥í•œë‹¤ë©´, ê³¼í•™ê³¼ ì‚°ì—…ì€ ì–´ë–»ê²Œ ë‹¬ë¼ì§ˆê¹Œìš”?
        </p>

        <div class="article-meta">
          <span>ì‘ì„±: LabWave Demo</span>
          <span>ì½ëŠ” ì‹œê°„: 3ë¶„</span>
        </div>
      </div>

      <!-- ì¹¼ëŸ¼ ë³¸ë¬¸ -->
      <article class="article-card">
        <h2>1) ì™œ â€˜ì–‘ìâ€™ê°€ ê²Œì„ ì²´ì¸ì €ì¸ê°€</h2>
        <p>
          ì¼ë°˜ ì»´í“¨í„°ëŠ” 0 ë˜ëŠ” 1ë¡œ ì •ë³´ë¥¼ ì²˜ë¦¬í•´ìš”. ë°˜ë©´, ì–‘ìì»´í“¨í„°ëŠ” â€˜ê²¹ì¹¨(ì¤‘ì²©)â€™ ê°™ì€ ì–‘ì íŠ¹ì„±ì„ í™œìš©í•´
          ì—¬ëŸ¬ ê²½ìš°ì˜ ìˆ˜ë¥¼ ë™ì‹œì— íƒìƒ‰í•  ìˆ˜ ìˆì–´ìš”. ê·¸ë˜ì„œ íŠ¹ì • ë¬¸ì œ(ì˜ˆ: ìµœì í™”, ì‹œë®¬ë ˆì´ì…˜)ì—ì„œëŠ” ì—„ì²­ë‚œ ì†ë„ í–¥ìƒì´ ê¸°ëŒ€ë©ë‹ˆë‹¤.
        </p>

        <h2>2) ë¬´ì—‡ì´ ë°”ë€”ê¹Œ</h2>
        <ul>
          <li><b>ì‹ ì•½ ê°œë°œ</b>: ë¶„ì ìˆ˜ì¤€ì˜ ì‹œë®¬ë ˆì´ì…˜ì´ ë” ì •êµí•´ì§ˆ ìˆ˜ ìˆì–´ìš”.</li>
          <li><b>ì†Œì¬/ë°°í„°ë¦¬</b>: ìƒˆë¡œìš´ ì†Œì¬ë¥¼ ì°¾ëŠ” íƒìƒ‰ì´ ë¹¨ë¼ì§ˆ ìˆ˜ ìˆì–´ìš”.</li>
          <li><b>ë¬¼ë¥˜/ê¸ˆìœµ</b>: ìµœì í™” ë¬¸ì œê°€ ë§ì€ ë¶„ì•¼ì—ì„œ íš¨ìœ¨ì´ í¬ê²Œ ì˜¤ë¥¼ ìˆ˜ ìˆì–´ìš”.</li>
        </ul>

        <h2>3) ì•„ì§ ë‚¨ì€ ê³¼ì œ</h2>
        <p>
          í˜„ì‹¤ì—ì„œëŠ” ì˜¤ë¥˜(ë…¸ì´ì¦ˆ) ë¬¸ì œê°€ í¬ê³ , ì•ˆì •ì ìœ¼ë¡œ í° ê·œëª¨ë¡œ í™•ì¥í•˜ëŠ” ê²ƒë„ ì–´ë µìŠµë‹ˆë‹¤.
          ê·¸ë˜ì„œ ë‹¹ë¶„ê°„ì€ â€œíŠ¹ì • ë¬¸ì œì— ê°•í•œ ì–‘ì + ê¸°ì¡´ ì»´í“¨í„°â€ê°€ í•¨ê»˜ ì“°ì´ëŠ” í˜•íƒœê°€ í˜„ì‹¤ì ì´ì—ìš”.
        </p>

        <div class="article-cta">
          <a class="btn btn-primary" href="#comments">ì´ ì£¼ì œì— ì˜ê²¬ ë‚¨ê¸°ê¸°</a>
          <a class="btn btn-ghost" href="index.html#content">ë‹¤ë¥¸ í† í”½ ë³´ê¸°</a>
        </div>
      </article>

      <!-- ì§„í–‰ ì¤‘ì¸ ì—°êµ¬ & í›„ì› ì„¹ì…˜ -->
      <section class="section-tight">
        <div class="section-head">
          <span class="section-pill">Ongoing Research</span>
          <h2 class="section-title">ì§€ê¸ˆ ì§„í–‰ì¤‘ì¸ ì—°êµ¬</h2>
          <p class="section-sub">LabWaveì—ì„œ ì£¼ëª©í•˜ëŠ” ì—°êµ¬ë¥¼ ì‚´í´ë³´ê³ , í›„ì›ìœ¼ë¡œ ì‘ì›í•  ìˆ˜ ìˆì–´ìš”.</p>
        </div>

        <div class="topic-grid">
          <div class="topic-card">
            <div class="topic-body">
              <h3 class="topic-title">ì–‘ì ì˜¤ë¥˜ ë³´ì •(QEC) ì†Œí˜•í™”</h3>
              <p class="topic-desc">
                ì–‘ìì»´í“¨í„°ì˜ ê°€ì¥ í° ë¬¸ì œì¸ ë…¸ì´ì¦ˆ(ì˜¤ë¥˜)ë¥¼ ì¤„ì´ê¸° ìœ„í•´, ë” ì ì€ íë¹„íŠ¸ë¡œ ì˜¤ë¥˜ ë³´ì • íš¨ìœ¨ì„ ëŒì–´ì˜¬ë¦¬ëŠ” ë°©ë²•ì„ ì—°êµ¬í•©ë‹ˆë‹¤.
              </p>
              <div class="topic-meta">
                <span>ì§„í–‰ë¥ : 00%</span>
                <span>ëª©í‘œ í›„ì›ê¸ˆ: 300ë§Œ ì›+</span>
              </div>
              <div class="center">
                <a class="btn btn-primary btn-sm" href="research-qec.html">ì—°êµ¬ ë³´ê¸°</a>
              </div>
            </div>
          </div>

          <div class="topic-card">
            <div class="topic-body">
              <h3 class="topic-title">ì‹ ì•½ í›„ë³´ ë¶„ì ì‹œë®¬ë ˆì´ì…˜</h3>
              <p class="topic-desc">
                ë‹¨ë°±ì§ˆ-ë¦¬ê°„ë“œ ê²°í•©ì„ ë” ë¹ ë¥´ê²Œ ì˜ˆì¸¡í•´ í›„ë³´ ë¬¼ì§ˆì„ ì¢íˆëŠ” ì—°êµ¬ì…ë‹ˆë‹¤.
              </p>
              <div class="topic-meta">
                <span>ì§„í–‰ë¥ : 00%</span>
                <span>ëª©í‘œ í›„ì›ê¸ˆ: 500ë§Œ ì›+</span>
              </div>
              <div class="center">
                <a class="btn btn-primary btn-sm" href="research-drug.html">ì—°êµ¬ ë³´ê¸°</a>
              </div>
            </div>
          </div>

          <div class="topic-card">
            <div class="topic-body">
              <h3 class="topic-title">ì°¨ì„¸ëŒ€ ë°°í„°ë¦¬ ì†Œì¬ íƒìƒ‰</h3>
              <p class="topic-desc">
                ê³ ì—ë„ˆì§€ë°€ë„/ì•ˆì „ì„±ì„ ë™ì‹œì— ë§Œì¡±í•˜ëŠ” ì†Œì¬ ì¡°í•©ì„ íƒìƒ‰í•©ë‹ˆë‹¤. í›„ë³´êµ°ì„ ì°¾ê³  ê²€ì¦ ìš°ì„ ìˆœìœ„ë¥¼ ì„¤ê³„í•´ìš”.
              </p>
              <div class="topic-meta">
                <span>ì§„í–‰ë¥ : 00%</span>
                <span>ëª©í‘œ í›„ì›ê¸ˆ: 800ë§Œ ì›+</span>
              </div>
              <div class="center">
                <a class="btn btn-primary btn-sm" href="research-battery.html">ì—°êµ¬ ë³´ê¸°</a>
              </div>
            </div>
          </div>
        </div>

        <div id="donate" class="donate-cta">
          <div>
            <h3 class="donate-title">ì—°êµ¬ë¥¼ ë” ë¹ ë¥´ê²Œ ì „ì§„ì‹œí‚¤ëŠ” í›„ì›</h3>
            <p class="donate-sub">
              ì´ í† í”½ì„ ë„˜ì–´, ë” ë„“ì€ ë¶„ì•¼ì˜ ì—°êµ¬ë“¤ì„ ì‚´í´ë³´ê³  ë§ˆìŒì´ ê°€ëŠ” ì—°êµ¬ë¥¼ ì„ íƒí•´ í›„ì›í•  ìˆ˜ ìˆì–´ìš”.
              LabWaveëŠ” â€œì¢‹ì€ ì—°êµ¬ê°€ ë” ë©€ë¦¬ ê°€ëŠ” ì—°ê²°â€ì„ ë§Œë“¤ê³ ì í•©ë‹ˆë‹¤.
            </p>
          </div>
          <a class="btn btn-primary" href="donate.html">í›„ì› í˜ì´ì§€ë¡œ ì´ë™</a>
        </div>
      </section>

      <!-- ëŒ“ê¸€/ëŒ€ëŒ“ê¸€ -->
      <section id="comments" class="comment-section">
        <div class="comment-head">
          <h2 class="comment-title">ëŒ“ê¸€</h2>
          <p class="comment-sub" id="commentHint">ëŒ“ê¸€ ì‘ì„±/ì¢‹ì•„ìš”/ì‚­ì œëŠ” ë¡œê·¸ì¸ í›„ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ìš”.</p>
        </div>

        <!-- ìƒˆ ëŒ“ê¸€ ì‘ì„± -->
        <form id="newCommentForm" class="comment-form">
          <div class="form-row">
            <label class="label">ë‚´ìš©</label>
            <textarea id="contentInput" class="textarea" maxlength="300" placeholder="ì˜ê²¬ì„ ë‚¨ê²¨ì£¼ì„¸ìš” (ìµœëŒ€ 300ì)" required></textarea>
          </div>

          <div class="form-actions">
            <button class="btn btn-primary" type="submit">ëŒ“ê¸€ ë“±ë¡</button>
            <button class="btn btn-ghost" type="button" id="resetBtn">ì´ˆê¸°í™”</button>
          </div>
        </form>

        <!-- ì •ë ¬ -->
        <div class="comment-toolbar">
          <button class="btn btn-ghost btn-sm" type="button" data-sort="newest">ìµœì‹ ìˆœ</button>
          <button class="btn btn-ghost btn-sm" type="button" data-sort="oldest">ì˜¤ë˜ëœìˆœ</button>
          <button class="btn btn-ghost btn-sm" type="button" data-sort="likes">ì¢‹ì•„ìš”ìˆœ</button>
        </div>

        <!-- ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸ -->
        <div id="commentList" class="comment-list"></div>
      </section>

    </div>
  </main>

  <script type="module">
    async function getMyProfile() {
  const { data: { user } } = await supabase.auth.getUser();
  if (!user) return { user: null, profile: null };

  const { data: profile, error } = await supabase
    .from("profiles")
    .select("id, nickname, role")
    .eq("id", user.id)
    .single();

  if (error) return { user, profile: null };
  return { user, profile };
  }  
    
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

    const SUPABASE_URL = "https://gjmffchyvthiwwhlwyam.supabase.co";
    const SUPABASE_KEY = "sb_publishable_U3s5fUx3Bm8TMs70FJawVA_aoCw7GOO";
    const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

    const PAGE_SLUG = "topic-quantum";
    const LIKE_STORE_KEY = `labwave_likes_${PAGE_SLUG}`;

    const $ = (sel) => document.querySelector(sel);
    const commentListEl = $("#commentList");
    const newCommentForm = $("#newCommentForm");
    const contentInput = $("#contentInput");
    const resetBtn = $("#resetBtn");
    const hintEl = $("#commentHint");

    let currentUser = null;
    let currentSort = "newest";

    function escapeHtml(str) {
      return (str ?? "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function formatTime(iso) {
      const d = new Date(iso);
      const yy = String(d.getFullYear()).slice(2);
      const mm = String(d.getMonth()+1).padStart(2,"0");
      const dd = String(d.getDate()).padStart(2,"0");
      const hh = String(d.getHours()).padStart(2,"0");
      const mi = String(d.getMinutes()).padStart(2,"0");
      return `${yy}.${mm}.${dd} ${hh}:${mi}`;
    }

    function getLikedSet() {
      try {
        const raw = localStorage.getItem(LIKE_STORE_KEY);
        const arr = raw ? JSON.parse(raw) : [];
        return new Set(Array.isArray(arr) ? arr : []);
      } catch {
        return new Set();
      }
    }

    function saveLikedSet(set) {
      localStorage.setItem(LIKE_STORE_KEY, JSON.stringify([...set]));
    }

    async function loadUser() {
      const { data: { user } } = await supabase.auth.getUser();
      currentUser = user ?? null;
    }

    async function getNicknameFromProfile() {
      if (!currentUser?.id) return null;

      const { data, error } = await supabase
        .from("profiles")
        .select("nickname")
        .eq("id", currentUser.id)
        .single();

      if (error) return null;
      return data?.nickname ?? null;
    }

    async function fetchComments() {
      let q = supabase
        .from("comments")
        .select("id,page_slug,parent_id,author,content,created_at,likes,is_deleted")
        .eq("page_slug", PAGE_SLUG)
        .eq("is_deleted", false);

      if (currentSort === "likes") {
        q = q.order("likes", { ascending: false }).order("created_at", { ascending: false });
      } else if (currentSort === "oldest") {
        q = q.order("created_at", { ascending: true });
      } else {
        q = q.order("created_at", { ascending: false });
      }

      const { data, error } = await q;
      if (error) {
        commentListEl.innerHTML = `<div class="comment-empty">ëŒ“ê¸€ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆì–´ìš”: ${escapeHtml(error.message)}</div>`;
        return [];
      }
      return data ?? [];
    }

    async function insertComment({ parent_id = null, content }) {
      const nickname = await getNicknameFromProfile();
      const author = nickname || currentUser?.email || "user";

      content = (content ?? "").trim().slice(0, 300);
      if (!author || !content) return;

      const { error } = await supabase.from("comments").insert({
        page_slug: PAGE_SLUG,
        parent_id,
        user_id: currentUser.id,
        author,
        content,
        likes: 0,
        is_deleted: false,
      });

      if (error) {
        alert("ë“±ë¡ ì‹¤íŒ¨: " + error.message);
        return;
      }
      await render();
    }

    async function likeOnce(commentId) {
      if (!currentUser) {
        alert("ë¡œê·¸ì¸ í›„ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.");
        return;
      }

      const liked = getLikedSet();
      if (liked.has(commentId)) {
        alert("ì´ë¯¸ ì¢‹ì•„ìš”ë¥¼ ëˆŒë €ì–´ìš”!");
        return;
      }
      liked.add(commentId);
      saveLikedSet(liked);

      const { error } = await supabase.rpc("increment_like", { cid: commentId });
      if (error) {
        liked.delete(commentId);
        saveLikedSet(liked);
        alert("ì¢‹ì•„ìš” ì‹¤íŒ¨: " + error.message);
        return;
      }
      await render();
    }

    async function softDelete(commentId) {
      if (!currentUser) {
        alert("ë¡œê·¸ì¸ í›„ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.");
        return;
      }
      const ok = confirm("ì´ ëŒ“ê¸€ì„ ì‚­ì œ(ìˆ¨ê¹€)í• ê¹Œìš”?");
      if (!ok) return;

      const { error } = await supabase.rpc("soft_delete_comment", { cid: commentId });
      if (error) {
        alert("ì‚­ì œ ì‹¤íŒ¨: " + error.message);
        return;
      }
      await render();
    }

    function buildTree(rows) {
      const map = new Map();
      rows.forEach(r => map.set(r.id, { ...r, children: [] }));

      const roots = [];
      map.forEach(node => {
        if (node.parent_id && map.has(node.parent_id)) map.get(node.parent_id).children.push(node);
        else roots.push(node);
      });

      const sortByTimeAsc = (a,b) => new Date(a.created_at) - new Date(b.created_at);
      const deepSort = (nodes) => {
        nodes.sort(sortByTimeAsc);
        nodes.forEach(n => deepSort(n.children));
      };
      deepSort(roots);

      const sortRoot = (a,b) => {
        if (currentSort === "likes") {
          if ((b.likes ?? 0) !== (a.likes ?? 0)) return (b.likes ?? 0) - (a.likes ?? 0);
          return new Date(b.created_at) - new Date(a.created_at);
        }
        if (currentSort === "oldest") return new Date(a.created_at) - new Date(b.created_at);
        return new Date(b.created_at) - new Date(a.created_at);
      };
      roots.sort(sortRoot);

      return roots;
    }

    function renderTree(tree, likedSet) {
      function renderNode(node, depth) {
        const indentClass = depth === 0 ? "cmt" : "cmt cmt-reply";
        const safeAuthor = escapeHtml(node.author);
        const safeContent = escapeHtml(node.content).replaceAll("\n","<br/>");
        const time = formatTime(node.created_at);
        const likes = node.likes ?? 0;
        const liked = likedSet.has(node.id);

        return `
          <div class="${indentClass}">
            <div class="cmt-top">
              <div class="cmt-author">${safeAuthor}</div>
              <div class="cmt-time">${time}</div>
            </div>

            <div class="cmt-content">${safeContent}</div>

            <div class="cmt-actions">
              <button class="cmt-btn" data-action="like" data-id="${node.id}" ${liked ? "data-liked='1'" : ""}>
                ğŸ‘ ${likes}${liked ? " (ì™„ë£Œ)" : ""}
              </button>
              <button class="cmt-btn" data-action="toggle-reply" data-id="${node.id}">ë‹µê¸€</button>
              <button class="cmt-btn" data-action="delete" data-id="${node.id}">ì‚­ì œ</button>
            </div>

            <div class="reply-box" id="replyBox-${node.id}" hidden>
              <form class="reply-form" data-parent="${node.id}">
                <div class="reply-row">
                  <textarea class="textarea" maxlength="300" placeholder="ëŒ€ëŒ“ê¸€ ë‚´ìš© (ìµœëŒ€ 300ì)" required></textarea>
                </div>
                <div class="reply-actions">
                  <button class="btn btn-primary btn-sm" type="submit">ëŒ€ëŒ“ê¸€ ë“±ë¡</button>
                  <button class="btn btn-ghost btn-sm" type="button" data-action="cancel-reply" data-id="${node.id}">ì·¨ì†Œ</button>
                </div>
              </form>
            </div>

            ${node.children.map(ch => renderNode(ch, depth+1)).join("")}
          </div>
        `;
      }
      return tree.map(n => renderNode(n, 0)).join("");
    }

    async function render() {
      await loadUser();

      const toolbar = document.querySelector(".comment-toolbar");

      // ë¹„ë¡œê·¸ì¸: ì‘ì„±/ì •ë ¬ ìˆ¨ê¹€, ì•ˆë‚´
      if (!currentUser) {
        newCommentForm.style.display = "none";
        if (toolbar) toolbar.style.display = "none";
        commentListEl.innerHTML = `<div class="comment-empty">ëŒ“ê¸€ì„ ë³´ë ¤ë©´ ë¨¼ì € ë¡œê·¸ì¸í•´ì¤˜!</div>`;
        hintEl.textContent = "ëŒ“ê¸€ ì‘ì„±/ì¢‹ì•„ìš”/ì‚­ì œëŠ” ë¡œê·¸ì¸ í›„ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ìš”.";
        return;
      }

      // ë¡œê·¸ì¸í–ˆì§€ë§Œ ë‹‰ë„¤ì„ ì—†ìŒ: ì‘ì„± ë§‰ê³  profileë¡œ ìœ ë„
      const nickname = await getNicknameFromProfile();
      if (!nickname) {
        newCommentForm.style.display = "none";
        if (toolbar) toolbar.style.display = "none";
        hintEl.textContent = "ëŒ“ê¸€ì„ ì“°ë ¤ë©´ ë¨¼ì € ë‹‰ë„¤ì„ì„ ì„¤ì •í•´ì¤˜!";
        commentListEl.innerHTML = `
          <div class="comment-empty">
            ë‹‰ë„¤ì„ì´ ì•„ì§ ì—†ì–´ìš”.<br/><br/>
            <a class="btn btn-primary btn-sm" href="profile.html">ë‹‰ë„¤ì„ ì„¤ì •í•˜ëŸ¬ ê°€ê¸°</a>
          </div>
        `;
        return;
      }

      // ë¡œê·¸ì¸ + ë‹‰ë„¤ì„ ìˆìŒ
      newCommentForm.style.display = "block";
      if (toolbar) toolbar.style.display = "flex";
      hintEl.textContent = `ë¡œê·¸ì¸ë¨ Â· ë‹‰ë„¤ì„: ${nickname}`;

      commentListEl.innerHTML = `<div class="comment-empty">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>`;

      const likedSet = getLikedSet();
      const rows = await fetchComments();

      if (!rows.length) {
        commentListEl.innerHTML = `<div class="comment-empty">ì•„ì§ ëŒ“ê¸€ì´ ì—†ì–´ìš”. ì²« ëŒ“ê¸€ì„ ë‚¨ê²¨ë³´ì„¸ìš”!</div>`;
        return;
      }

      const tree = buildTree(rows);
      commentListEl.innerHTML = renderTree(tree, likedSet);

      // ë‹µê¸€ í† ê¸€
      commentListEl.querySelectorAll("[data-action='toggle-reply']").forEach(btn => {
        btn.addEventListener("click", () => {
          const id = btn.dataset.id;
          const box = document.getElementById(`replyBox-${id}`);
          box.hidden = !box.hidden;
        });
      });

      // ë‹µê¸€ ì·¨ì†Œ
      commentListEl.querySelectorAll("[data-action='cancel-reply']").forEach(btn => {
        btn.addEventListener("click", () => {
          const id = btn.dataset.id;
          const box = document.getElementById(`replyBox-${id}`);
          box.hidden = true;
        });
      });

      // ëŒ€ëŒ“ê¸€ ë“±ë¡
      commentListEl.querySelectorAll(".reply-form").forEach(form => {
        form.addEventListener("submit", async (e) => {
          e.preventDefault();
          const parent_id = form.dataset.parent;
          const content = form.querySelector("textarea").value;
          await insertComment({ parent_id, content });
        });
      });

      // ì¢‹ì•„ìš”
      commentListEl.querySelectorAll("[data-action='like']").forEach(btn => {
        btn.addEventListener("click", async () => {
          await likeOnce(btn.dataset.id);
        });
      });

      // ì‚­ì œ
      commentListEl.querySelectorAll("[data-action='delete']").forEach(btn => {
        btn.addEventListener("click", async () => {
          await softDelete(btn.dataset.id);
        });
      });
    }

    newCommentForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      await insertComment({ content: contentInput.value });
      contentInput.value = "";
    });

    resetBtn.addEventListener("click", () => {
      contentInput.value = "";
      contentInput.focus();
    });

    document.querySelectorAll("[data-sort]").forEach(btn => {
      btn.addEventListener("click", async () => {
        currentSort = btn.dataset.sort;
        await render();
      });
    });

    render();
  </script>
</body>
</html>
